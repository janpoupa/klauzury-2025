
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-extras@7.6.0/dist/aframe-extras.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

    <script>
  AFRAME.registerComponent('mindar-occlusion-manager', {
    init: function () {
      const target = this.el; // The <a-entity mindar-image-target...>
      const occlusionEntity = target.querySelector('[occlusion-component]');
      
      if (!occlusionEntity) return;

      // 1. Store the component data
      const occlusionData = occlusionEntity.getAttribute('occlusion-component');
      
      // 2. Remove the component immediately so it doesn't init while invisible
      occlusionEntity.removeAttribute('occlusion-component');
      
      // 3. Listen for 'targetFound'
      target.addEventListener('targetFound', () => {
        // 4. Re-add the component, forcing it to initialize *now*
        occlusionEntity.setAttribute('occlusion-component', occlusionData);
      });
      
      // 5. (Optional) Clean up when lost
      target.addEventListener('targetLost', () => {
        occlusionEntity.removeAttribute('occlusion-component');
      });
    }
  });
</script>
    <script src="https://cdn.jsdelivr.net/gh/akbartus/A-Frame-Occlusion-Component/js/occlusion-component.js"></script>
  </head>
  <body>
    <a-scene bloom="threshold: 1.0; strength: 1; radius: 0.2;" mindar-image="imageTargetSrc: FAV4.mind; filterMinCF:0.00001; filterBeta: 10000" color-space="grayscale" renderer="colorManagement: true; toneMapping: ACESFilmic;" vr-mode-ui="enabled: false" ar-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false" light="defaultLightsEnabled: false">
      <a-assets>
        <a-asset-item id="vakuova" src="diagram01_01.glb"></a-asset-item>
        <a-asset-item id="vials" src="vials_0_ANIM.glb"></a-asset-item>
      </a-assets>

      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

      <a-entity mindar-image-target="targetIndex: 2" animation-mixer>
        <a-gltf-model rotation="0 0 0" position="0 0 0" scale="1.2 1.2 1.2" src="#vials" animation-mixer>
      </a-entity>

      <a-entity mindar-image-target="targetIndex: 0" animation-mixer>
        <a-gltf-model rotation="90 0 0 " position="-0.4 -0.25 0" scale="0.04 0.04 0.04" src="#vakuova" animation-mixer>
      </a-entity>

    
      <a-entity mindar-image-target="targetIndex: 1">

        <a-gltf-model
            src="stena.glb"
            material="colorWrite: false;"
            render-order="0">
        </a-gltf-model>

        <a-gltf-model
            src="mistnost.glb"
            animation-mixer
            render-order="1">
        </a-gltf-model>

      </a-entity>
    </a-scene>
  </body>
</html>